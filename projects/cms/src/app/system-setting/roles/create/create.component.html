<cms-page [title]="editMode ? 'Chỉnh sửa vai trò' : 'Tạo mới vai trò'">
  <div action>
    <button
      nz-button
      nzType="primary"
      (click)="submitRole()"
      [nzLoading]="formSubmitting"
    >
      <i
        nz-icon
        [nzType]="formSubmitting ? 'loading' : 'save'"
        nzTheme="outline"
      ></i>
      <span class="d-none d-md-inline-block">{{
        editMode ? "Cập nhật" : "Tạo mới"
      }}</span>
    </button>
  </div>
  <div content class="my-3 mx-0 mx-md-3">
    <form
      nz-form
      [formGroup]="createRoleForm"
      (ngSubmit)="submitRole()"
      class="form-wr"
    >
      <nz-form-item class="d-none">
        <input type="hidden" nz-input id="id" formControlName="id" />
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="name"
          >Mã vai trò</nz-form-label
        >
        <nz-form-control
          [nzSm]="14"
          [nzXs]="24"
          nzErrorTip="Mã vai trò phải tối thiểu 5 và dưới 50 ký tự!"
        >
          <nz-input-group>
            <input
              nz-input
              formControlName="name"
              id="name"
              placeholder="Ex: ROLE_ACCOUNT_MANAGER"
              (input)="transformCode()"
            />
          </nz-input-group>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="description" nzRequired
          >Tên hiển thị</nz-form-label
        >
        <nz-form-control
          [nzSm]="14"
          [nzXs]="24"
          nzErrorTip="Vui lòng nhập tên hiển thị!"
        >
          <input
            nz-input
            formControlName="description"
            id="description"
            placeholder="Nhập tên hiển thị"
          />
        </nz-form-control>
      </nz-form-item>
      <button class="d-none"></button>
    </form>
    <div class="permission-select-wr">
      <h5 nz-typography class="mt-6 mb-4">
        Danh sách quyền
        <button
          nz-button
          nzType="primary"
          nzGhost
          [nzSize]="'small'"
          class="mx-3"
          (click)="checkAllGroup(true)"
        >
          <i nz-icon nzType="check" nzTheme="outline"></i> Chọn tất cả
        </button>
        <button
          nz-button
          nzType="default"
          nzGhost
          [nzSize]="'small'"
          (click)="checkAllGroup(false)"
        >
          Bỏ chọn
        </button>
      </h5>
      <nz-empty nzNotFoundImage="simple" *ngIf="!pemissionTree"></nz-empty>

      <nz-collapse *ngIf="pemissionTree">
        <nz-collapse-panel
          *ngFor="let group of pemissionTree"
          [nzHeader]="group.name + ' (' + group.permissions.length + ')'"
          [nzExtra]="extraTpl"
          [nzActive]="false"
        >
          <div nz-row [nzGutter]="12">
            <div
              *ngFor="let item of group.permissions"
              nz-col
              nzXs="12"
              nzSm="8"
              nzMd="7"
              nzLg="6"
              nzXl="5"
              nzXXl="4"
              class="my-2"
            >
              <label
                nz-checkbox
                [(ngModel)]="item.checked"
                (ngModelChange)="selectItem(item, group.id)"
                >{{ item.name }}</label
              >
            </div>
          </div>
          <ng-template #extraTpl>
            <!-- You can use stopPropagation if you don't want the panel to toggle -->
            <label
              nz-checkbox
              [(ngModel)]="group.checkAll"
              [nzIndeterminate]="group.indeterminate"
              (click)="$event.stopPropagation()"
              (ngModelChange)="checkAll(group.id)"
              >Chọn tất cả</label
            >
          </ng-template>
        </nz-collapse-panel>
      </nz-collapse>
    </div>
  </div>
</cms-page>
